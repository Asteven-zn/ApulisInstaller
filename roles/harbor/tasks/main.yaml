# 创建harbor仓库
#- import_tasks: init.yaml

- name: 下载镜像tar文件
  copy: src={{ item }} dest={{HARBOR_LOCATION}}/images/
  with_fileglob:
    - "{{ base_dir }}/resources/images/*.tar"

- name: Docker 登录 harbor
  command:
    cmd: "{{bin_dir}}/docker login {{HARBOR_DOMAIN}}:{{ HARBOR_HTTPS_PORT}} \
      -u admin -p {{ lookup('file', '{{ base_dir }}/credentials/harbor.pwd') }}"
  register: login_result

- include: push.yaml image="{{HARBOR_LOCATION}}/images/{{ item | basename }}"
  with_fileglob:
    - "{{ base_dir }}/resources/images/*.tar"
  when: '"Login Succeeded" in login_result.stdout'
